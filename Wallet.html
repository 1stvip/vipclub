<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="images//videoslogo/vip.png">
    <title>Ù…Ø­ÙØ¸ØªÙŠ - VipClub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- ğŸ”¥ Ø¥Ø¶Ø§ÙØ© Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { 
            --primary: #6366f1; 
            --success: #10b981;
            --danger: #ef4444; 
            --dark: #1e293b; 
            --bg: #f1f5f9; 
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ */
        .navbar { background: #fff; height: 65px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 9999; }
        .icon-btn { font-size: 1.4rem; color: var(--dark); cursor: pointer; position: relative; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: 0.2s; border: none; background: none; }
        .icon-btn:hover { background: #f0f0f0; }
        .badge { position: absolute; top: 5px; right: 5px; background: var(--danger); color: white; font-size: 0.7rem; min-width: 18px; height: 18px; display: none; align-items: center; justify-content: center; border-radius: 50%; border: 2px solid white; font-weight: bold; }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
        .dropdown-overlay { position: fixed; top: 70px; width: 320px; max-width: 90%; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.25); display: none; flex-direction: column; z-index: 10000; border: 1px solid #ddd; overflow: hidden; }
        #profileDropdown { right: 20px; text-align: center; padding: 25px 20px; }
        #notifDropdown { left: 20px; text-align: right; }
        .dropdown-overlay.active { display: flex !important; animation: slideDown 0.2s ease-out; }
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        .profile-large-icon { font-size: 3.5rem; color: var(--primary); margin-bottom: 10px; display: block; }
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø±ØµÙŠØ¯ */
        .wallet-header { background: linear-gradient(135deg, #6366f1, #a855f7); color: white; padding: 30px 20px; text-align: center; border-radius: 0 0 30px 30px; margin-bottom: 20px; }
        .balance-amount { font-size: 2.5rem; font-weight: bold; margin: 10px 0; }

        /* Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ */
        .refresh-section { text-align: center; margin-bottom: 10px; }
        .refresh-btn { background: white; border: 1px solid #ddd; padding: 10px 25px; border-radius: 50px; cursor: pointer; font-weight: bold; color: var(--dark); transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: inline-flex; align-items: center; gap: 10px; }
        .refresh-btn:hover { background: var(--primary); color: white; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; padding: 20px; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
        .gift-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.1); position: relative; }
        .card-top { background: #f3ba2f; color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 1.4rem; }
        .card-body { padding: 20px; position: relative; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; background: #fff; }
        
        .scratch-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #d1d5db, #9ca3af); display: flex; align-items: center; justify-content: center; color: #4b5563; font-weight: bold; cursor: crosshair; z-index: 5; transition: opacity 0.5s; user-select: none; }
        .scratch-overlay.revealed { opacity: 0; pointer-events: none; }
        
        .secret-code { font-size: 1.5rem; font-weight: bold; letter-spacing: 2px; color: var(--primary); margin-bottom: 10px; }
        .copy-btn { background: #f1f5f9; border: none; padding: 8px 15px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; color: var(--dark); display: none; align-items: center; gap: 8px; font-weight: bold; }

        .card-info { padding: 12px 20px; background: #f8fafc; font-size: 0.8rem; color: #64748b; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { color: var(--danger); background: none; border: none; cursor: pointer; font-size: 1.1rem; }

        /* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notif-item { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center; }
        .notif-item.unread { background: #eef2ff; border-right: 4px solid var(--primary); }
        .notif-text { flex: 1; }
        .delete-notif-btn { color: #ccc; cursor: pointer; padding: 5px; transition: 0.2s; }
        .delete-notif-btn:hover { color: var(--danger); }
        
        .refresh-notif { cursor: pointer; transition: 0.5s; }
        .refreshing { transform: rotate(360deg); color: var(--primary); }

        #screenOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9998; display: none; background: rgba(0,0,0,0.3); backdrop-filter: blur(2px); }

        /* Ø±Ø³Ø§Ø¦Ù„ Firebase */
        .firebase-alert {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            z-index: 10002;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 400px;
        }
        
        .firebase-success {
            background: #10b981;
            color: white;
            border-left: 4px solid #059669;
        }
        
        .firebase-error {
            background: #ef4444;
            color: white;
            border-left: 4px solid #dc2626;
        }
        
        .firebase-warning {
            background: #f59e0b;
            color: white;
            border-left: 4px solid #d97706;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø°Ù */
        .deleting {
            animation: deleteAnimation 0.5s forwards;
        }
        
        @keyframes deleteAnimation {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.9); opacity: 0.5; }
            100% { transform: scale(0); opacity: 0; height: 0; margin: 0; padding: 0; }
        }
    </style>
</head>
<body>

<div id="screenOverlay" onclick="closeAll()"></div>

<!-- Ø±Ø³Ø§Ø¦Ù„ Firebase -->
<div id="firebaseAlert" class="firebase-alert" style="display: none;"></div>

<nav class="navbar">
    <button class="icon-btn" onclick="openMenu('profileDropdown')">
        <i class="fas fa-user-circle"></i>
    </button>
    <div style="font-weight: bold;">Ù…Ø­ÙØ¸ØªÙŠ ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</div>
    <button class="icon-btn" onclick="openMenu('notifDropdown')">
        <i class="fas fa-bell"></i>
        <span class="badge" id="notifBadge">0</span>
    </button>
</nav>

<div id="profileDropdown" class="dropdown-overlay">
    <i class="fas fa-user-circle profile-large-icon"></i>
    <h4 id="p_nickname" style="margin: 5px 0;">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
    <p style="margin-bottom: 15px; color: #64748b; font-size: 0.9rem;">Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨: <span id="p_id">0</span></p>
    
    <div style="background: #f8fafc; padding: 12px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
        <span style="font-size: 0.8rem; color: #64748b; display: block; margin-bottom: 4px;">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</span>
        <b style="color: var(--success); font-size: 1.1rem;"><span id="p_egp">0</span> Ø¬.Ù…</b>
        <div style="margin-top: 5px; font-size: 0.8rem;">
            Ø¯ÙˆÙ„Ø§Ø±: <b id="p_usd">0</b> USD
        </div>
    </div>
    
    <button onclick="logout()" style="width:100%; padding:12px; background:#fee2e2; color:var(--danger); border:none; border-radius:10px; cursor:pointer; font-weight: bold;">
        <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    </button>
</div>

<div id="notifDropdown" class="dropdown-overlay">
    <div style="padding:15px; font-weight:bold; border-bottom:1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <span>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
            <i class="fas fa-sync-alt refresh-notif" id="notifRefreshIcon" onclick="refreshNotifs()" title="ØªØ­Ø¯ÙŠØ«"></i>
        </div>
        <button onclick="markAllRead()" style="background:none; border:none; color:var(--primary); cursor:pointer; font-size: 0.75rem;">ØªØ­Ø¯ÙŠØ¯ ÙƒÙ‚Ø±ÙˆØ¡</button>
    </div>
    <div id="notifList" style="max-height:300px; overflow-y:auto;"></div>
</div>

<div class="wallet-header">
    <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯</small>
    <div class="balance-amount" id="userBalance">0.00 Ø¬.Ù…</div>
</div>

<div class="refresh-section">
    <button class="refresh-btn" onclick="loadWallet()">
        <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    </button>
</div>

<div class="cards-grid" id="cardsGrid"></div>

<script>
// ğŸ”¥ ØªÙƒÙˆÙŠÙ† Firebase (Ù†ÙØ³ ØªÙƒÙˆÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰)
const firebaseConfig = {
    apiKey: "AIzaSyAVSzkDLqi1G-hpfEPqvBMmuyYRfEuaTKk",
    authDomain: "vipclub-1d04a.firebaseapp.com",
    databaseURL: "https://vipclub-1d04a-default-rtdb.firebaseio.com",
    projectId: "vipclub-1d04a",
    storageBucket: "vipclub-1d04a.firebasestorage.app",
    messagingSenderId: "120667552740",
    appId: "1:120667552740:web:02085765fd43eb0080e5f1"
};

// ØªÙ‡ÙŠØ¦Ø© Firebase
let database, auth;

function initializeFirebase() {
    try {
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        database = firebase.database();
        auth = firebase.auth();
        
        console.log('âœ… Firebase initialized for wallet');
        
    } catch (error) {
        console.error('âŒ Firebase initialization error:', error);
        showFirebaseAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase', 'error');
    }
}

// ===== Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© =====
function checkWalletSession() {
    try {
        // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        const walletData = JSON.parse(localStorage.getItem('walletUserData'));
        const walletSession = JSON.parse(localStorage.getItem('walletSession'));
        
        if (!walletData || !walletSession) {
            console.log('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙØ¸Ø© Ø£Ùˆ Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©');
            return false;
        }
        
        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø­Ø¯ÙŠØ«Ø© (Ø£Ù‚Ù„ Ù…Ù† 10 Ø¯Ù‚Ø§Ø¦Ù‚)
        const sessionAge = Date.now() - walletSession.timestamp;
        if (sessionAge > 10 * 60 * 1000) { // 10 Ø¯Ù‚Ø§Ø¦Ù‚
            console.log('âŒ Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ù†ØªÙ‡ÙŠØ©');
            localStorage.removeItem('walletSession');
            localStorage.removeItem('walletUserData');
            return false;
        }
        
        // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø£Ø®ÙŠØ± Ù„Ù„Ù†Ø´Ø§Ø·
        walletSession.lastActivity = Date.now();
        localStorage.setItem('walletSession', JSON.stringify(walletSession));
        
        console.log('âœ… Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù†Ø´Ø·Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:', walletData.nickname);
        return true;
        
    } catch (error) {
        console.error('Error checking wallet session:', error);
        return false;
    }
}

// ===== Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­Ø°ÙˆÙ Ù…Ø¤Ù‚ØªØ§Ù‹ =====
let deletedCards = JSON.parse(localStorage.getItem('deletedCards')) || {};

// ===== Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© =====
async function loadWallet() {
    try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹
        if (!checkWalletSession()) {
            showFirebaseAlert('âš ï¸ Ø§Ù†ØªÙ‡Øª Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'warning');
            setTimeout(() => {
                window.location.href = 'home.html';
            }, 3000);
            return;
        }
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ù† localStorage
        const walletData = JSON.parse(localStorage.getItem('walletUserData'));
        
        if (!walletData) {
            showFirebaseAlert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙØ¸Ø©', 'error');
            setTimeout(() => {
                window.location.href = 'home.html';
            }, 2000);
            return;
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('userBalance').innerText = `${walletData.balanceEGP || 0} Ø¬.Ù…`;
        document.getElementById('p_egp').innerText = walletData.balanceEGP || 0;
        document.getElementById('p_usd').innerText = walletData.balanceUSD || 0;
        document.getElementById('p_nickname').innerText = walletData.nickname || walletData.username;
        document.getElementById('p_id').innerText = walletData.numericId || walletData.id;
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ firebaseKeyØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        if (database && walletData.firebaseKey) {
            await loadWalletFromFirebase(walletData.firebaseKey, walletData.numericId);
        } else {
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯ ØªØµÙÙŠØ© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª
            const filteredCards = filterDeletedCards(walletData.purchasedCards || []);
            renderCards(filteredCards);
        }
        
        showFirebaseAlert(' ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­âœ…', 'success');
        
    } catch (error) {
        console.error('Error loading wallet:', error);
        showFirebaseAlert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø©', 'error');
    }
}

// ===== Ø¯Ø§Ù„Ø© ØªØµÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© =====
function filterDeletedCards(cards) {
    if (!cards || !Array.isArray(cards)) return [];
    
    // ØªØ­ÙˆÙŠÙ„ deletedCards Ù…Ù† ÙƒØ§Ø¦Ù† Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
    const deletedCodes = Object.keys(deletedCards);
    
    // ØªØµÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: Ø¥Ø¨Ù‚Ø§Ø¡ ÙÙ‚Ø· Ø§Ù„ØªÙŠ Ù„Ù… ÙŠØªÙ… Ø­Ø°ÙÙ‡Ø§
    return cards.filter(card => {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ code
        if (card.code) {
            return !deletedCodes.includes(card.code);
        }
        return true; // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ codeØŒ Ù†ØªØ±Ùƒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    });
}

// ===== Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Firebase =====
async function loadWalletFromFirebase(firebaseKey, numericId) {
    try {
        if (!database) {
            console.log('Database not initialized');
            return;
        }
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… firebaseKey
        let userRef;
        if (firebaseKey) {
            userRef = database.ref('users/' + firebaseKey);
        } else if (numericId) {
            // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… numericId
            const snapshot = await database.ref('users').orderByChild('numericId').equalTo(numericId).once('value');
            if (snapshot.exists()) {
                const users = snapshot.val();
                const userId = Object.keys(users)[0];
                userRef = database.ref('users/' + userId);
            }
        }
        
        if (!userRef) {
            console.log('User reference not found');
            renderCards([]);
            return;
        }
        
        const snapshot = await userRef.once('value');
        
        if (snapshot.exists()) {
            const userData = snapshot.val();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            const walletData = JSON.parse(localStorage.getItem('walletUserData')) || {};
            const updatedWalletData = {
                ...walletData,
                balanceEGP: userData.balanceEGP || walletData.balanceEGP,
                balanceUSD: userData.balanceUSD || walletData.balanceUSD,
                purchasedCards: userData.purchasedCards || walletData.purchasedCards || [],
                notifications: userData.notifications || []
            };
            
            localStorage.setItem('walletUserData', JSON.stringify(updatedWalletData));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            document.getElementById('userBalance').innerText = `${updatedWalletData.balanceEGP || 0} Ø¬.Ù…`;
            document.getElementById('p_egp').innerText = updatedWalletData.balanceEGP || 0;
            document.getElementById('p_usd').innerText = updatedWalletData.balanceUSD || 0;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø¹Ø¯ ØªØµÙÙŠØ© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª
            const filteredCards = filterDeletedCards(updatedWalletData.purchasedCards || []);
            renderCards(filteredCards);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            updateNotifications(updatedWalletData.notifications || []);
            
            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ù† Firebase');
        }
        
    } catch (error) {
        console.error('Error loading wallet from Firebase:', error);
        // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        const walletData = JSON.parse(localStorage.getItem('walletUserData'));
        if (walletData) {
            const filteredCards = filterDeletedCards(walletData.purchasedCards || []);
            renderCards(filteredCards);
        }
    }
}

// ===== Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª =====
function renderCards(cards) {
    const grid = document.getElementById('cardsGrid');
    
    if (!cards || cards.length === 0) {
        grid.innerHTML = '<p style="text-align:center; grid-column:1/-1; padding:50px; color:#888;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
        return;
    }
    
    grid.innerHTML = '';
    
    cards.forEach((card, index) => {
        const cardDate = card.purchaseDate ? new Date(card.purchaseDate).toLocaleDateString('ar-EG') : 
                        (card.date || 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ');
        const cardProduct = card.product || card.value || 'Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©';
        const cardCode = card.code || 'XXXX-XXXX-XXXX';
        const cardPrice = card.price || card.value || '';
        const cardColor = card.color || '#f3ba2f';
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„ÙŠØ³Øª Ù…Ø­Ø°ÙˆÙØ©
        if (deletedCards[cardCode]) {
            return; // ØªØ®Ø·ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        }
        
        grid.innerHTML += `
            <div class="gift-card" id="card-${index}" data-code="${cardCode}">
                <div class="card-top" style="background:${cardColor}">
                    <i class="fas fa-gift"></i> ${cardProduct}
                </div>
                <div class="card-body">
                    <div class="secret-code">${cardCode}</div>
                    <button class="copy-btn" id="copy-btn-${index}" onclick="copyCode('${cardCode}', this)">
                        <i class="fas fa-copy"></i> Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
                    </button>
                    <div class="scratch-overlay" id="overlay-${index}" onclick="revealCard(${index})">
                        Ø§Ø³Ø­Ø¨ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ÙƒÙˆØ¯
                    </div>
                </div>
                <div class="card-info">
                    <span>${cardDate}</span>
                    ${cardPrice ? `<span style="color: var(--success); font-weight: bold;">${cardPrice}</span>` : ''}
                    <button class="delete-btn" onclick="deleteCard(${index}, '${cardCode}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        `;
    });
}

// ===== Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ =====
async function deleteCard(index, cardCode) {
    const warningMessage = `âš ï¸ ØªØ­Ø°ÙŠØ± Ù‡Ù€Ø§Ù…\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ\n\n- Ø§Ù„ÙƒÙˆØ¯: ${cardCode}\n- Ø³ÙˆÙ ØªÙÙ‚Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙ„Ù† ØªØ¹ÙˆØ¯ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.\n- Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.`;

    if (!confirm(warningMessage)) return;
    
    try {
        // 1. Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª
        deletedCards[cardCode] = {
            deletedAt: new Date().toISOString(),
            cardIndex: index
        };
        
        // Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª ÙÙŠ localStorage
        localStorage.setItem('deletedCards', JSON.stringify(deletedCards));
        
        // 2. ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„Ø­Ø°Ù
        const cardElement = document.getElementById(`card-${index}`);
        if (cardElement) {
            cardElement.classList.add('deleting');
        }
        
        // 3. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const walletData = JSON.parse(localStorage.getItem('walletUserData'));
        if (!walletData) return;
        
        // 4. ØªØµÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        const cards = walletData.purchasedCards || [];
        const filteredCards = cards.filter(card => card.code !== cardCode);
        walletData.purchasedCards = filteredCards;
        
        // 5. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        localStorage.setItem('walletUserData', JSON.stringify(walletData));
        
        // 6. Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Firebase Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§ØªØµØ§Ù„
        if (database && walletData.firebaseKey) {
            try {
                await database.ref('users/' + walletData.firebaseKey).update({
                    purchasedCards: filteredCards,
                    updatedAt: new Date().toISOString()
                });
                
                // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ù„Ù„Ø­Ø°Ù ÙÙŠ Firebase
                const deleteRecord = {
                    code: cardCode,
                    deletedAt: new Date().toISOString(),
                    userId: walletData.numericId || walletData.id,
                    product: cards.find(c => c.code === cardCode)?.product || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'
                };
                
                await database.ref('deletedCards').push(deleteRecord);
                
            } catch (firebaseError) {
                console.error('Firebase update error:', firebaseError);
            }
        }
        
        // 7. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ£Ø«ÙŠØ±
        setTimeout(() => {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
            renderCards(filteredCards);
            showFirebaseAlert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹', 'success');
        }, 500);
        
    } catch (error) {
        console.error('Error deleting card:', error);
        showFirebaseAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', 'error');
    }
}

// ===== Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª =====
function updateNotifications(notifications) {
    const list = document.getElementById('notifList');
    const badge = document.getElementById('notifBadge');
    
    if (!notifications || notifications.length === 0) {
        list.innerHTML = '<div style="padding:20px; color:#888; text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>';
        badge.style.display = 'none';
        return;
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©
    const unreadCount = notifications.filter(n => !n.read).length;
    if (unreadCount > 0) {
        badge.innerText = unreadCount;
        badge.style.display = 'flex';
    } else {
        badge.style.display = 'none';
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    list.innerHTML = '';
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ù„Ù„Ø£Ù‚Ø¯Ù…
    const sortedNotifs = [...notifications].sort((a, b) => {
        const idA = a.id || 0;
        const idB = b.id || 0;
        return idB - idA;
    });
    
    sortedNotifs.forEach((n, index) => {
        const div = document.createElement('div');
        div.className = `notif-item ${!n.read ? 'unread' : ''}`;
        div.innerHTML = `
            <div class="notif-text">
                <div>${n.text || 'Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¯ÙˆÙ† Ù†Øµ'}</div>
                <small style="color:#aaa;">${n.date || 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</small>
            </div>
            <i class="fas fa-trash-alt delete-notif-btn" onclick="deleteNotification(${n.id || index})" title="Ø­Ø°Ù"></i>
        `;
        list.appendChild(div);
    });
}

// ===== Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø¥Ø´Ø¹Ø§Ø± =====
async function deleteNotification(notifId) {
    try {
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const walletData = JSON.parse(localStorage.getItem('walletUserData'));
        if (!walletData) return;
        
        // ØªØµÙÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        const notifications = (walletData.notifications || []).filter(n => n.id !== notifId);
        walletData.notifications = notifications;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        localStorage.setItem('walletUserData', JSON.stringify(walletData));
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Firebase
        if (database && walletData.firebaseKey) {
            try {
                await database.ref('users/' + walletData.firebaseKey).update({
                    notifications: notifications,
                    updatedAt: new Date().toISOString()
                });
            } catch (firebaseError) {
                console.error('Firebase update error:', firebaseError);
            }
        }
        
        showFirebaseAlert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', 'success');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        setTimeout(() => {
            updateNotifications(notifications);
        }, 500);
        
    } catch (error) {
        console.error('Error deleting notification:', error);
        showFirebaseAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', 'error');
    }
}

// ===== Ø¯Ø§Ù„Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø© =====
async function markAllRead() {
    try {
        const walletData = JSON.parse(localStorage.getItem('walletUserData'));
        if (!walletData) return;
        
        const notifications = walletData.notifications || [];
        if (notifications.length === 0) {
            showFirebaseAlert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'warning');
            return;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©
        const updatedNotifs = notifications.map(n => ({
            ...n,
            read: true
        }));
        
        walletData.notifications = updatedNotifs;
        localStorage.setItem('walletUserData', JSON.stringify(walletData));
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Firebase
        if (database && walletData.firebaseKey) {
            try {
                await database.ref('users/' + walletData.firebaseKey).update({
                    notifications: updatedNotifs,
                    updatedAt: new Date().toISOString()
                });
            } catch (firebaseError) {
                console.error('Firebase update error:', firebaseError);
            }
        }
        
        showFirebaseAlert('âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©', 'success');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        setTimeout(() => {
            updateNotifications(updatedNotifs);
        }, 500);
        
    } catch (error) {
        console.error('Error marking all as read:', error);
        showFirebaseAlert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'error');
    }
}

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… =====
function openMenu(id) {
    const target = document.getElementById(id);
    const isOpen = target.classList.contains('active');
    closeAll();
    if(!isOpen) {
        target.classList.add('active');
        document.getElementById('screenOverlay').style.display = 'block';
        if(id === 'notifDropdown') {
            const walletData = JSON.parse(localStorage.getItem('walletUserData'));
            if (walletData) {
                updateNotifications(walletData.notifications || []);
            }
        }
    }
}

function closeAll() {
    document.querySelectorAll('.dropdown-overlay').forEach(m => m.classList.remove('active'));
    document.getElementById('screenOverlay').style.display = 'none';
}

// ===== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª =====
function revealCard(id) {
    const overlay = document.getElementById(`overlay-${id}`);
    if (overlay) {
        overlay.classList.add('revealed');
        const copyBtn = document.getElementById(`copy-btn-${id}`);
        if (copyBtn) {
            copyBtn.style.display = 'flex';
        }
    }
}

function copyCode(code, btn) {
    navigator.clipboard.writeText(code);
    const oldHtml = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
    btn.style.background = 'var(--success)';
    btn.style.color = 'white';
    setTimeout(() => {
        btn.innerHTML = oldHtml;
        btn.style.background = '#f1f5f9';
        btn.style.color = 'var(--dark)';
    }, 2000);
}

// ===== Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ =====
function logout() {
    // Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©
    localStorage.removeItem('walletSession');
    localStorage.removeItem('walletUserData');
    // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø±
    // localStorage.removeItem('deletedCards');
    
    showFirebaseAlert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©', 'success');
    
    setTimeout(() => {
        window.location.href = 'home.html';
    }, 1500);
}

// ===== Ø¯Ø§Ù„Ø© Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª =====
function clearDeletedCards() {
    deletedCards = {};
    localStorage.removeItem('deletedCards');
    showFirebaseAlert('âœ… ØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©', 'success');
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    setTimeout(() => {
        loadWallet();
    }, 500);
}

// ===== Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Firebase =====
function showFirebaseAlert(message, type) {
    const alertDiv = document.getElementById('firebaseAlert');
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
    `;
    alertDiv.className = `firebase-alert firebase-${type}`;
    alertDiv.style.display = 'flex';
    
    setTimeout(() => {
        alertDiv.style.display = 'none';
    }, 4000);
}

// ===== Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª =====
function refreshNotifs() {
    const icon = document.getElementById('notifRefreshIcon');
    icon.classList.add('refreshing');
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    loadWallet();
    
    setTimeout(() => {
        icon.classList.remove('refreshing');
    }, 800);
}

// ===== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© =====
window.onload = async function() {
    // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
    const savedDeletedCards = localStorage.getItem('deletedCards');
    if (savedDeletedCards) {
        deletedCards = JSON.parse(savedDeletedCards);
    }
    
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    initializeFirebase();
    
    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©
    setTimeout(() => {
        loadWallet();
    }, 1000);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© (Ù…Ø¹ Ø§Ù„ØªØµÙÙŠØ©)
    setInterval(() => {
        if (checkWalletSession()) {
            loadWallet();
        }
    }, 30000);
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            // Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¹ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØªØ¨ÙˆÙŠØ¨ØŒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
            if (!checkWalletSession()) {
                showFirebaseAlert('âš ï¸ Ø§Ù†ØªÙ‡Øª Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©', 'warning');
                setTimeout(() => {
                    window.location.href = 'home.html';
                }, 3000);
            }
        }
    });
};
</script>
</body>
</html>