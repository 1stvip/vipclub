<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘‘ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© VIP Club</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo h1 {
            color: #333;
            font-size: 28px;
            font-weight: 800;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        /* Ø§Ù„Ø¨Ø­Ø« */
        .search-container {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        .search-box {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        thead {
            background: #667eea;
        }
        
        th {
            padding: 15px;
            color: white;
            font-weight: 600;
            text-align: right;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        
        tr:hover {
            background: #f9f9f9;
        }
        
        .banned-row {
            background-color: #fff5f5;
        }
        
        /* Ø®Ù„Ø§ÙŠØ§ Ø®Ø§ØµØ© */
        .user-id {
            background: linear-gradient(90deg, #4f46e5, #8b5cf6);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 1px;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }
        
        .username {
            font-weight: bold;
            color: #333;
        }
        
        .password {
            font-family: monospace;
            background: #f1f5f9;
            padding: 5px 10px;
            border-radius: 5px;
            color: #4338ca;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-banned {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* Ø£Ø±ØµØ¯Ø© */
        .balance-cell {
            font-weight: bold;
            padding: 6px 10px;
            border-radius: 6px;
            display: inline-block;
            min-width: 80px;
        }
        
        .balance-egp {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .balance-usd {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }
        
        /* Ø£ÙØ¹Ø§Ù„ */
        .actions {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 6px 10px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }
        
        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .alert-info {
            background: #e0f2fe;
            color: #0369a1;
            border: 1px solid #bae6fd;
        }
        
        /* Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ø¥Ø´Ø¹Ø§Ø± Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ */
        .new-user-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(90deg, #10b981, #34d399);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .section-title {
            margin: 20px 0 10px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
            color: #4f46e5;
            font-size: 18px;
        }
        
        .balance-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .balance-input {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .balance-input input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ† */
        .deleted-section {
            margin-top: 30px;
            background: #fef2f2;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #fecaca;
        }
        
        .deleted-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .deleted-table th {
            background: #ef4444;
            padding: 10px;
            color: white;
            font-size: 12px;
        }
        
        .deleted-table td {
            padding: 8px;
            font-size: 12px;
            border-bottom: 1px solid #fee2e2;
        }
        
        .deleted-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .status-permanent {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-temporary {
            background: #fef3c7;
            color: #92400e;
        }
    </style>
</head>
<body>
    <!-- Ø¥Ø´Ø¹Ø§Ø± Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ -->
    <div id="newUserNotification" class="new-user-notification">
        ğŸ‘¤ <strong>ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯!</strong>
        <div id="newUserInfo" style="font-size: 12px; margin-top: 5px;"></div>
    </div>
    
    <div class="container">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">ğŸ‘‘</div>
                <h1>VIP Club - Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
            </div>
            
            <div class="search-container">
                <div class="search-icon">ğŸ”</div>
                <input type="text" id="searchInput" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…..." onkeyup="filterUsers()">
            </div>
            
            <div>
                <button class="btn btn-primary" onclick="loadUsers()">
                    <span>ğŸ”„</span> ØªØ­Ø¯ÙŠØ«
                </button>
                <button class="btn btn-success" onclick="showAddModal()">
                    <span>â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
                </button>
                <button class="btn btn-warning" onclick="showDeletedUsersSection()">
                    <span>ğŸ—‘ï¸</span> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ†
                </button>
                <button class="btn btn-danger" onclick="goToHome()">
                    <span>ğŸ </span> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeUsers">0</div>
                <div class="stat-label">âœ… Ù†Ø´Ø·ÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="bannedUsers">0</div>
                <div class="stat-label">ğŸš« Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayUsers">0</div>
                <div class="stat-label">ğŸ“… Ù…Ø³Ø¬Ù„ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
        </div>
        
        <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
        <div id="alertContainer"></div>
        
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
        <div id="connectionInfo" style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
            <h3 style="margin-bottom: 10px;">ğŸ”— Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</h3>
            <div style="font-family: monospace; font-size: 14px;">
                <div>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: <span style="color: green">us-central1</span></div>
                <div>ğŸ”— Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: <span style="color: blue">https://vipclub-1d04a-default-rtdb.firebaseio.com</span></div>
                <div>âœ… Ø§Ù„Ø­Ø§Ù„Ø©: <span id="connectionStatus" style="color: green">Ø¬Ø§Ø±Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</span></div>
                <div>ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="liveUserCount">0</span></div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <div class="table-container">
            <table id="usersTable">
                <thead>
                    <tr>
                        <th width="100">Ø§Ù„Ù…Ø¹Ø±Ù</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±</th>
                        <th>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th>
                        <th width="150">Ø§Ù„Ø±ØµÙŠØ¯</th>
                        <th width="100">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th width="150">Ø§Ù„ØªÙˆØ§ØµÙ„</th>
                        <th width="120">Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                        <th width="250">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="9">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ† (Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
        <div id="deletedUsersSection" class="deleted-section" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; color: #ef4444;">ğŸ—‘ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ†</h3>
                <button class="btn btn-primary" onclick="loadDeletedUsers()">
                    <span>ğŸ”„</span> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                </button>
            </div>
            <table class="deleted-table">
                <thead>
                    <tr>
                        <th width="80">Ø§Ù„Ù…Ø¹Ø±Ù</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th width="150">Ø§Ù„ØªÙˆØ§ØµÙ„</th>
                        <th width="120">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø°Ù</th>
                        <th width="100">Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù</th>
                        <th width="100">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø°Ù</th>
                        <th width="200">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="deletedUsersBody">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ†...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *</label>
                <input type="text" id="addUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
            </div>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                <input type="text" id="addPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±</label>
                <input type="text" id="addNickname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="addEmail" placeholder="example@email.com">
            </div>
            <div class="form-group">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="tel" id="addPhone" placeholder="01012345678">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ (EGP)</label>
                <input type="number" id="addBalanceEGP" placeholder="0.00" value="0">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ (USD)</label>
                <input type="number" id="addBalanceUSD" placeholder="0.00" value="0">
            </div>
            <div class="modal-actions">
                <button class="btn btn-success" onclick="addUser()">ğŸ’¾ Ø­ÙØ¸</button>
                <button class="btn btn-danger" onclick="hideAddModal()">âœ– Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…</h2>
            <input type="hidden" id="editUserId">
            
            <div class="section-title">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *</label>
                <input type="text" id="editUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±</label>
                <input type="text" id="editNickname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">
            </div>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="text" id="editPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            
            <div class="section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</div>
            <div class="form-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="editEmail" placeholder="example@email.com">
            </div>
            <div class="form-group">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="tel" id="editPhone" placeholder="01012345678">
            </div>
            
            <div class="section-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø±ØµØ¯Ø©</div>
            <div class="balance-controls">
                <div class="balance-input">
                    <label>Ø±ØµÙŠØ¯ EGP</label>
                    <input type="number" id="editBalanceEGP" placeholder="0.00" step="0.01">
                </div>
                <div class="balance-input">
                    <label>Ø±ØµÙŠØ¯ USD</label>
                    <input type="number" id="editBalanceUSD" placeholder="0.00" step="0.01">
                </div>
            </div>
            
            <div class="balance-controls" style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="addToBalance('EGP')" style="flex: 1;">
                    <span>â•</span> Ø¥Ø¶Ø§ÙØ© EGP
                </button>
                <button class="btn btn-success" onclick="addToBalance('USD')" style="flex: 1;">
                    <span>â•</span> Ø¥Ø¶Ø§ÙØ© USD
                </button>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-success" onclick="updateUser()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                <button class="btn btn-danger" onclick="hideEditModal()">âœ– Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

<script>
// ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase - Realtime Database
const firebaseConfig = {
    apiKey: "AIzaSyAVSzkDLqi1G-hpfEPqvBMmuyYRfEuaTKk",
    authDomain: "vipclub-1d04a.firebaseapp.com",
    databaseURL: "https://vipclub-1d04a-default-rtdb.firebaseio.com",
    projectId: "vipclub-1d04a",
    storageBucket: "vipclub-1d04a.firebasestorage.app",
    messagingSenderId: "120667552740",
    appId: "1:120667552740:web:02085765fd43eb0080e5f1"
};

// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
let database;
let allUsers = [];
let currentEditingUser = null;

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ID Ø±Ù‚Ù…ÙŠ (Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
function generateNumericId() {
    return Math.floor(100000 + Math.random() * 900000);
}

// 1. ØªÙ‡ÙŠØ¦Ø© Firebase
function initializeFirebase() {
    try {
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        database = firebase.database();
        
        showAlert('âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase Realtime Database', 'success');
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        testConnection();
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        loadUsers();
        
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
        listenForNewUsers();
        
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
        listenForUpdates();
        
    } catch (error) {
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
    }
}

// Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
function listenForNewUsers() {
    if (!database) return;
    
    database.ref('users').on('child_added', (snapshot) => {
        const newUser = snapshot.val();
        const userId = snapshot.key;
        
        console.log('ğŸ‘¤ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯:', newUser.username);
        
        // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
        showNewUserNotification(newUser);
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        loadUsers();
        
        // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¥Ø´Ø¹Ø§Ø±
        playNotificationSound();
    });
}

// 2. Ø¥Ø´Ø¹Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
function showNewUserNotification(user) {
    const notification = document.getElementById('newUserNotification');
    const userInfo = document.getElementById('newUserInfo');
    
    userInfo.innerHTML = `
        ğŸ‘¤ ${user.username} 
        ğŸ”¢ ID: ${user.numericId || 'N/A'}
        ğŸ“… ${new Date(user.createdAt || new Date()).toLocaleTimeString('ar-EG')}
    `;
    
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 5000);
}

// 3. ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
function playNotificationSound() {
    try {
        const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3');
        audio.volume = 0.3;
        audio.play();
    } catch (e) {
        console.log('Sound not available');
    }
}

// 4. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
async function testConnection() {
    try {
        await database.ref('connection_test').set({
            timestamp: new Date().toISOString(),
            message: 'Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'
        });
        
        document.getElementById('connectionStatus').textContent = 'âœ… Ù…ØªØµÙ„';
        document.getElementById('connectionStatus').style.color = 'green';
        
    } catch (error) {
        document.getElementById('connectionStatus').textContent = 'âŒ ØºÙŠØ± Ù…ØªØµÙ„';
        document.getElementById('connectionStatus').style.color = 'red';
    }
}

// 5. Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
function listenForUpdates() {
    if (!database) return;
    
    database.ref('users').on('value', (snapshot) => {
        if (snapshot.exists()) {
            const count = Object.keys(snapshot.val()).length;
            document.getElementById('liveUserCount').textContent = count;
        }
    });
}

// 6. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
async function loadUsers() {
    const tbody = document.getElementById('tableBody');
    
    if (!database) {
        tbody.innerHTML = '<tr><td colspan="9">âŒ Firebase ØºÙŠØ± Ù…ØªØµÙ„</td></tr>';
        return;
    }
    
    try {
        const snapshot = await database.ref('users').once('value');
        allUsers = [];
        let total = 0, active = 0, banned = 0, today = 0;
        const todayDate = new Date().toDateString();
        
        if (snapshot.exists()) {
            const usersData = snapshot.val();
            
            for (const userId in usersData) {
                const userData = usersData[userId];
                const user = {
                    id: userId,
                    firebaseKey: userId,
                    numericId: userData.numericId || generateNumericId(),
                    username: userData.username || '',
                    nickname: userData.nickname || '',
                    password: userData.password || '',
                    email: userData.email || '',
                    phone: userData.phone || '',
                    isBanned: userData.isBanned === true,
                    banReason: userData.banReason || '',
                    banExpiry: userData.banExpiry || '',
                    balanceEGP: parseFloat(userData.balanceEGP) || 0,
                    balanceUSD: parseFloat(userData.balanceUSD) || 0,
                    createdAt: userData.createdAt || '',
                    updatedAt: userData.updatedAt || ''
                };
                
                // ØªØ­Ø¯ÙŠØ« numericId Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (!userData.numericId) {
                    await database.ref('users/' + userId).update({
                        numericId: user.numericId,
                        updatedAt: new Date().toISOString()
                    });
                }
                
                allUsers.push(user);
                
                total++;
                if (user.isBanned) banned++; else active++;
                if (user.createdAt && new Date(user.createdAt).toDateString() === todayDate) today++;
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        updateStats(total, active, banned, today);
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        displayUsers(allUsers);
        
    } catch (error) {
        tbody.innerHTML = `<tr><td colspan="9">âŒ Ø®Ø·Ø£: ${error.message}</td></tr>`;
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ' + error.message, 'error');
    }
}

// 7. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
function displayUsers(users) {
    const tbody = document.getElementById('tableBody');
    
    if (!users || users.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="9" style="text-align: center; padding: 40px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ‘¥</div>
                    <h3 style="color: #666;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                    <button class="btn btn-success" onclick="showAddModal()" style="margin-top: 15px;">
                        â• Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù…
                    </button>
                </td>
            </tr>
        `;
        return;
    }
    
    let html = '';
    
    users.forEach(user => {
        const isBanned = user.isBanned === true;
        const statusClass = isBanned ? 'status-banned' : 'status-active';
        const statusText = isBanned ? 'ğŸš« Ù…Ø­Ø¸ÙˆØ±' : 'âœ… Ù†Ø´Ø·';
        const rowClass = isBanned ? 'banned-row' : '';
        
        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¸Ø±
        let banInfo = '';
        if (isBanned && user.banReason) {
            banInfo = `<div style="font-size: 11px; color: #991b1b;">${user.banReason}</div>`;
        }
        
        // Ø§Ù„ØªØ§Ø±ÙŠØ®
        let dateDisplay = '---';
        if (user.createdAt) {
            try {
                dateDisplay = new Date(user.createdAt).toLocaleDateString('ar-EG');
            } catch (e) {
                dateDisplay = user.createdAt;
            }
        }
        
        html += `
            <tr class="${rowClass}" id="user-row-${user.id}">
                <td>
                    <div class="user-id" title="Firebase Key: ${user.id}\nNumeric ID: ${user.numericId}">
                        ${user.numericId.toString().padStart(6, '0')}
                    </div>
                </td>
                <td>
                    <div class="username">${user.username || '---'}</div>
                </td>
                <td>${user.nickname || '---'}</td>
                <td>
                    <div class="password">${user.password || '---'}</div>
                </td>
                <td>
                    <div style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
                        <span class="balance-cell balance-egp" title="Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡ Ø§Ù„Ù…ØµØ±ÙŠ">
                            ${user.balanceEGP.toFixed(2)} EGP
                        </span>
                        <span class="balance-cell balance-usd" title="Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±">
                            ${user.balanceUSD.toFixed(2)} USD
                        </span>
                    </div>
                </td>
                <td>
                    <div class="status-badge ${statusClass}">${statusText}</div>
                    ${banInfo}
                </td>
                <td>
                    <div>ğŸ“± ${user.phone || '---'}</div>
                    <div>ğŸ“§ ${user.email || '---'}</div>
                </td>
                <td>${dateDisplay}</td>
                <td>
                    <div class="actions">
                        <button class="action-btn" style="background: #e0e7ff; color: #3730a3;" onclick="openEditModal('${user.id}')" title="ØªØ¹Ø¯ÙŠÙ„">
                            âœï¸ ØªØ¹Ø¯ÙŠÙ„
                        </button>
                        ${isBanned ? 
                            `<button class="action-btn" style="background: #d1fae5; color: #065f46;" onclick="unbanUser('${user.id}')" title="ÙÙƒ Ø§Ù„Ø­Ø¸Ø±">
                                ğŸ”“ ÙÙƒ Ø­Ø¸Ø±
                            </button>` : 
                            `<button class="action-btn" style="background: #fef3c7; color: #92400e;" onclick="banUser('${user.id}')" title="Ø­Ø¸Ø±">
                                ğŸ”’ Ø­Ø¸Ø±
                            </button>`
                        }
                        <button class="action-btn" style="background: #fee2e2; color: #991b1b;" onclick="deleteUser('${user.id}')" title="Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ">
                            ğŸ—‘ï¸ Ø­Ø°Ù
                        </button>
                    </div>
                </td>
            </tr>
        `;
    });
    
    tbody.innerHTML = html;
}

// 8. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
function updateStats(total, active, banned, today) {
    document.getElementById('totalUsers').textContent = total;
    document.getElementById('activeUsers').textContent = active;
    document.getElementById('bannedUsers').textContent = banned;
    document.getElementById('todayUsers').textContent = today;
}

// 9. Ø§Ù„Ø¨Ø­Ø«
function filterUsers() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    
    if (!search) {
        displayUsers(allUsers);
        return;
    }
    
    const filtered = allUsers.filter(user => {
        return (user.username && user.username.toLowerCase().includes(search)) ||
               (user.nickname && user.nickname.toLowerCase().includes(search)) ||
               (user.email && user.email.toLowerCase().includes(search)) ||
               (user.phone && user.phone.includes(search)) ||
               (user.numericId && user.numericId.toString().includes(search));
    });
    
    displayUsers(filtered);
}

// 10. Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
function showAddModal() {
    document.getElementById('addModal').style.display = 'flex';
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById('addUsername').value = '';
    document.getElementById('addPassword').value = '';
    document.getElementById('addNickname').value = '';
    document.getElementById('addEmail').value = '';
    document.getElementById('addPhone').value = '';
    document.getElementById('addBalanceEGP').value = '0';
    document.getElementById('addBalanceUSD').value = '0';
}

function hideAddModal() {
    document.getElementById('addModal').style.display = 'none';
}

function showEditModal() {
    document.getElementById('editModal').style.display = 'flex';
}

function hideEditModal() {
    document.getElementById('editModal').style.display = 'none';
    currentEditingUser = null;
}

// 11. Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
async function addUser() {
    const username = document.getElementById('addUsername').value.trim();
    const password = document.getElementById('addPassword').value.trim();
    const nickname = document.getElementById('addNickname').value.trim();
    const email = document.getElementById('addEmail').value.trim();
    const phone = document.getElementById('addPhone').value.trim();
    const balanceEGP = parseFloat(document.getElementById('addBalanceEGP').value) || 0;
    const balanceUSD = parseFloat(document.getElementById('addBalanceUSD').value) || 0;
    
    if (!username || !password) {
        showAlert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
        return;
    }
    
    try {
        const numericId = generateNumericId();
        const newUserRef = database.ref('users').push();
        
        await newUserRef.set({
            numericId: numericId,
            username: username,
            password: password,
            nickname: nickname || username,
            email: email || '',
            phone: phone || '',
            isBanned: false,
            banExpiry: "",
            banReason: "",
            balanceEGP: balanceEGP,
            balanceUSD: balanceUSD,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        });
        
        showAlert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­ (ID: ${numericId})`, 'success');
        hideAddModal();
        
    } catch (error) {
        showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
    }
}

// 12. ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
async function openEditModal(userId) {
    const user = allUsers.find(u => u.id === userId);
    if (!user) return;
    
    currentEditingUser = user;
    
    document.getElementById('editUserId').value = user.id;
    document.getElementById('editUsername').value = user.username || '';
    document.getElementById('editNickname').value = user.nickname || '';
    document.getElementById('editPassword').value = user.password || '';
    document.getElementById('editEmail').value = user.email || '';
    document.getElementById('editPhone').value = user.phone || '';
    document.getElementById('editBalanceEGP').value = user.balanceEGP || 0;
    document.getElementById('editBalanceUSD').value = user.balanceUSD || 0;
    
    showEditModal();
}

// 13. ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
async function updateUser() {
    if (!currentEditingUser) return;
    
    const userId = document.getElementById('editUserId').value;
    const username = document.getElementById('editUsername').value.trim();
    const nickname = document.getElementById('editNickname').value.trim();
    const password = document.getElementById('editPassword').value.trim();
    const email = document.getElementById('editEmail').value.trim();
    const phone = document.getElementById('editPhone').value.trim();
    const balanceEGP = parseFloat(document.getElementById('editBalanceEGP').value) || 0;
    const balanceUSD = parseFloat(document.getElementById('editBalanceUSD').value) || 0;
    
    if (!username) {
        showAlert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
        return;
    }
    
    try {
        const updates = {
            username: username,
            nickname: nickname || username,
            email: email || '',
            phone: phone || '',
            balanceEGP: balanceEGP,
            balanceUSD: balanceUSD,
            updatedAt: new Date().toISOString()
        };
        
        // Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©
        if (password) {
            updates.password = password;
        }
        
        await database.ref('users/' + userId).update(updates);
        
        showAlert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        hideEditModal();
        loadUsers();
        
    } catch (error) {
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ' + error.message, 'error');
    }
}

// 14. Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯
function addToBalance(currency) {
    if (!currentEditingUser) return;
    
    const amount = prompt(`Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡ (${currency}):`, '0');
    if (amount === null || isNaN(parseFloat(amount))) return;
    
    const numericAmount = parseFloat(amount);
    const currentBalance = parseFloat(document.getElementById(`editBalance${currency}`).value) || 0;
    
    document.getElementById(`editBalance${currency}`).value = (currentBalance + numericAmount).toFixed(2);
    
    showAlert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ${numericAmount} ${currency} Ø¥Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯`, 'success');
}

// 15. Ø­Ø¸Ø± Ù…Ø³ØªØ®Ø¯Ù…
async function banUser(userId) {
    const user = allUsers.find(u => u.id === userId);
    if (!user) return;
    
    const reason = prompt('Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±:');
    if (!reason) return;
    
    const days = prompt('Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø¸Ø± (0 Ù„Ù„Ø¯Ø§Ø¦Ù…):', '7');
    let expiry;
    
    if (days === '0') {
        expiry = 'permanent';
    } else {
        const daysNum = parseInt(days) || 7;
        expiry = new Date(Date.now() + daysNum * 86400000).toISOString();
    }
    
    try {
        await database.ref('users/' + userId).update({
            isBanned: true,
            banReason: reason,
            banExpiry: expiry,
            bannedAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        });
        
        showAlert('âœ… ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'success');
        loadUsers();
        
    } catch (error) {
        showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
    }
}

// 16. ÙÙƒ Ø­Ø¸Ø±
async function unbanUser(userId) {
    if (!confirm('ÙÙƒ Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
    
    try {
        await database.ref('users/' + userId).update({
            isBanned: false,
            banReason: '',
            banExpiry: '',
            updatedAt: new Date().toISOString()
        });
        
        showAlert('âœ… ØªÙ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø±', 'success');
        loadUsers();
        
    } catch (error) {
        showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
    }
}

// 17. Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
async function deleteUser(userId) {
    const user = allUsers.find(u => u.id === userId);
    if (!user) return;
    
    const deleteType = prompt(`Ù†ÙˆØ¹ Ø§Ù„Ø­Ø°Ù Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${user.username}:\n\n1. Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ (Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡)\n2. Ø­Ø°Ù Ù…Ø¤Ù‚Øª (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡)\n\nØ£Ø¯Ø®Ù„ 1 Ø£Ùˆ 2:`, '2');
    
    if (!deleteType) return;
    
    if (deleteType === '1') {
        // Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${user.username} (ID: ${user.numericId}) Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ\n\nâš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) return;
        
        try {
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            await database.ref('permanent_deleted_users').push({
                numericId: user.numericId,
                username: user.username,
                email: user.email,
                phone: user.phone,
                balanceEGP: user.balanceEGP,
                balanceUSD: user.balanceUSD,
                deletedAt: new Date().toISOString(),
                deletedBy: 'admin',
                originalFirebaseKey: userId,
                reason: 'Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ'
            });
            
            // Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            await database.ref('users/' + userId).remove();
            
            showAlert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${user.username} Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹`, 'success');
            loadUsers();
            
        } catch (error) {
            showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
        }
    } else if (deleteType === '2') {
        // Ø­Ø°Ù Ù…Ø¤Ù‚Øª (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡)
        const reason = prompt('Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):');
        
        try {
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
            await database.ref('deleted_users').push({
                numericId: user.numericId,
                username: user.username,
                email: user.email,
                phone: user.phone,
                balanceEGP: user.balanceEGP,
                balanceUSD: user.balanceUSD,
                isBanned: user.isBanned,
                banReason: user.banReason,
                banExpiry: user.banExpiry,
                deletedAt: new Date().toISOString(),
                deletedBy: 'admin',
                originalFirebaseKey: userId,
                reason: reason || 'Ø­Ø°Ù Ù…Ø¤Ù‚Øª'
            });
            
            // Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
            await database.ref('users/' + userId).remove();
            
            showAlert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${user.username} Ù…Ø¤Ù‚ØªØ§Ù‹ (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡)`, 'success');
            loadUsers();
            
        } catch (error) {
            showAlert('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
        }
    }
}

// ============ Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ† ============

// 18. Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ†
function showDeletedUsersSection() {
    const deletedSection = document.getElementById('deletedUsersSection');
    const usersTable = document.querySelector('.table-container');
    
    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
    if (deletedSection.style.display === 'none') {
        deletedSection.style.display = 'block';
        usersTable.style.display = 'none';
        loadDeletedUsers();
    } else {
        deletedSection.style.display = 'none';
        usersTable.style.display = 'block';
    }
}

// 19. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ†
async function loadDeletedUsers() {
    const deletedBody = document.getElementById('deletedUsersBody');
    
    if (!database) {
        deletedBody.innerHTML = '<tr><td colspan="7">âŒ Firebase ØºÙŠØ± Ù…ØªØµÙ„</td></tr>';
        return;
    }
    
    try {
        const snapshot = await database.ref('deleted_users').once('value');
        
        if (!snapshot.exists()) {
            deletedBody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ—‘ï¸</div>
                        <h4 style="color: #666;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø­Ø°ÙˆÙÙŠÙ† Ù…Ø¤Ù‚ØªØ§Ù‹</h4>
                        <p style="color: #999; margin-top: 10px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ù…Ø¤Ù‚ØªØ§Ù‹ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        let html = '';
        const deletedData = snapshot.val();
        
        for (const deletedId in deletedData) {
            const user = deletedData[deletedId];
            
            let dateDisplay = '---';
            if (user.deletedAt) {
                try {
                    dateDisplay = new Date(user.deletedAt).toLocaleString('ar-EG');
                } catch (e) {
                    dateDisplay = user.deletedAt;
                }
            }
            
            let deleteType = 'Ù…Ø¤Ù‚Øª';
            let typeClass = 'status-temporary';
            
            if (user.reason && user.reason.includes('Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ')) {
                deleteType = 'Ù†Ù‡Ø§Ø¦ÙŠ';
                typeClass = 'status-permanent';
            }
            
            html += `
                <tr>
                    <td>
                        <div style="font-family: monospace; font-size: 12px; background: #f1f5f9; padding: 5px; border-radius: 5px;">
                            ${user.numericId || '---'}
                        </div>
                    </td>
                    <td>
                        <div style="font-weight: bold;">${user.username || '---'}</div>
                    </td>
                    <td>
                        <div>ğŸ“± ${user.phone || '---'}</div>
                        <div>ğŸ“§ ${user.email || '---'}</div>
                    </td>
                    <td>
                        <div style="font-size: 11px;">${dateDisplay}</div>
                    </td>
                    <td>
                        <div style="font-size: 11px; color: #666;">${user.reason || '---'}</div>
                    </td>
                    <td>
                        <div class="deleted-status ${typeClass}">${deleteType}</div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px; justify-content: center;">
                            <button class="action-btn" style="background: #10b981; color: white;" onclick="restoreUser('${deletedId}', ${user.numericId})" title="Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                                ğŸ”„ Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                            </button>
                            <button class="action-btn" style="background: #ef4444; color: white;" onclick="permanentDelete('${deletedId}', '${user.username}')" title="Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ">
                                ğŸ—‘ï¸ Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        deletedBody.innerHTML = html;
        
    } catch (error) {
        deletedBody.innerHTML = `<tr><td colspan="7">âŒ Ø®Ø·Ø£: ${error.message}</td></tr>`;
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ†: ' + error.message, 'error');
    }
}

// 20. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø°ÙˆÙ
async function restoreUser(deletedId, numericId) {
    if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
    
    try {
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø°ÙˆÙ
        const snapshot = await database.ref('deleted_users/' + deletedId).once('value');
        const deletedUser = snapshot.val();
        
        if (!deletedUser) {
            showAlert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
            return;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const newUserRef = database.ref('users').push();
        
        await newUserRef.set({
            numericId: numericId,
            username: deletedUser.username,
            password: deletedUser.password || '123456',
            nickname: deletedUser.nickname || deletedUser.username,
            email: deletedUser.email || '',
            phone: deletedUser.phone || '',
            balanceEGP: deletedUser.balanceEGP || 0,
            balanceUSD: deletedUser.balanceUSD || 0,
            isBanned: deletedUser.isBanned || false,
            banReason: deletedUser.banReason || '',
            banExpiry: deletedUser.banExpiry || '',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        });
        
        // Ø­Ø°Ù Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
        await database.ref('deleted_users/' + deletedId).remove();
        
        showAlert(`âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${deletedUser.username} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        loadDeletedUsers();
        loadUsers();
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        setTimeout(() => {
            showDeletedUsersSection();
        }, 1000);
        
    } catch (error) {
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ' + error.message, 'error');
    }
}

// 21. Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
async function permanentDelete(deletedId, username) {
    if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${username} Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ\n\nâš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) return;
    
    try {
        // Ù†Ù‚Ù„ Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        const snapshot = await database.ref('deleted_users/' + deletedId).once('value');
        const deletedUser = snapshot.val();
        
        if (deletedUser) {
            await database.ref('permanent_deleted_users').push({
                ...deletedUser,
                permanentlyDeletedAt: new Date().toISOString(),
                permanentlyDeletedBy: 'admin'
            });
        }
        
        // Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
        await database.ref('deleted_users/' + deletedId).remove();
        
        showAlert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${username} Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹`, 'success');
        loadDeletedUsers();
        
    } catch (error) {
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ' + error.message, 'error');
    }
}

// 22. Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
function showAlert(message, type) {
    const container = document.getElementById('alertContainer');
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type}`;
    alertDiv.innerHTML = `
        <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
        <div style="flex: 1;">${message}</div>
        <button onclick="this.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer; font-size: 16px;">Ã—</button>
    `;
    
    container.insertBefore(alertDiv, container.firstChild);
    
    setTimeout(() => {
        if (alertDiv.parentElement) {
            alertDiv.remove();
        }
    }, 10000);
}

// 23. Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
function showConnectionInfo() {
    const infoDiv = document.getElementById('connectionInfo');
    infoDiv.style.display = infoDiv.style.display === 'none' ? 'block' : 'none';
}

// 24. Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
function goToHome() {
    window.location.href = 'home.html';
}

// 25. Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.onload = function() {
    initializeFirebase();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    setInterval(loadUsers, 30000);
};

// Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
window.testApp = function() {
    console.log('Firebase connected:', !!database);
    console.log('Users count:', allUsers.length);
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
    if (database) {
        const testRef = database.ref('users').push();
        const numericId = generateNumericId();
        testRef.set({
            numericId: numericId,
            username: 'test_' + Date.now().toString().slice(-6),
            password: 'test123',
            nickname: 'Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ',
            email: 'test@example.com',
            phone: '010' + Math.floor(10000000 + Math.random() * 90000000),
            balanceEGP: 1000,
            balanceUSD: 50,
            isBanned: false,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        }).then(() => console.log('âœ… Test user added with ID:', numericId));
    }
};
</script>
</body>
</html>